<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN'
	'http://ibatis.apache.org/dtd/sql-map-2.dtd'>
<sqlMap>
	<typeAlias alias="tour" type="item.tour.TourVO" />
	<!-- 리절트 맵 정의 -->
	<resultMap id="boardtour" class="tour">
		<result property="no" column="no" />
		<result property="name" column="name" />
		<result property="price" column="price" />
		<result property="content" column="content" />
		<result property="country" column="country" />
		<result property="region" column="region"/>
		<result property="readcount" column="readcount"/>
		<result property="image1" column="image1" />
		<result property="image2" column="image2" />
		<result property="image3" column="image3" />
		<result property="reg_date" column="reg_date" />
		<result property="grade" column="grade" /> 
	</resultMap>

	<!-- 공통으로 사용할 select 절 정의 -->
	<sql id="select-allT">
		SELECT * FROM TOUR
	</sql>

	<!-- 공통으로 사용할 where-no 절 정의 -->
	<sql id="where-noT">
		WHERE no = #no#
	</sql>

	<!-- select 쿼리문 정의 -->
	<select id="selectAllT" resultMap="boardtour">
		<include refid="select-allT" />
		ORDER BY NO DESC
	</select>
	
	<select id="Search_Tour" resultMap="boardtour" parameterClass="java.util.Map">
		<include refid="select-allT" />
		WHERE (name like '%'||#tourname#||'%' or country like '%'||#tourname#||'%' or region like '%'||#tourname#||'%')
	</select>
	
	<select id="selectOneT" resultMap="boardhotel" parameterClass="int">
		<include refid="select-allT"/>
		<include refid="where-noT" />
	</select>
	
	<!-- 인기순 -->
	<select id="Search_TourR" resultMap="boardtour" parameterClass="java.util.Map">
		<include refid="select-allT" />
		WHERE (name like '%'||#tourname#||'%' or country like '%'||#tourname#||'%' or region like '%'||#tourname#||'%')
		order by readcount desc
	</select>
	<!-- 가격순 -->
	<select id="Search_TourP" resultMap="boardtour" parameterClass="java.util.Map">
		<include refid="select-allT" />
		WHERE (name like '%'||#tourname#||'%' or country like '%'||#tourname#||'%' or region like '%'||#tourname#||'%')
		order by price asc
	</select>
	<!-- 별점순 -->
	<select id="Search_TourG" resultMap="boardtour" parameterClass="java.util.Map">
		<include refid="select-allT" />
		WHERE (name like '%'||#tourname#||'%' or country like '%'||#tourname#||'%' or region like '%'||#tourname#||'%')
		order by grade desc
	</select>
	
	<!-- 등록 -->
	<insert id="insertTour" parameterClass="tour">
			insert into tour(no, name, price, content, country, region, readcount, image1, image2, image3, reg_date, grade)
			values(seq_tournum.nextval, #name#, #price#, #content#, #country#, #region#, 0, #image1#, #image2#, #image3#, sysdate, #grade#)	
	</insert>
	
	<!-- 조회수 증가 -->
	<update id="readHitTour" parameterClass="int">
		update tour set readcount = readcount+1 where no=#no#
	</update>
	
	<!-- 수정 -->
	<update id="updateTour" parameterClass="tour">
		update tour set name=#name#,price=#price#,content=#content#,country=#country#,region=#region#,image1=#image1#,image2=#image2#
		where no=#no#
	</update>
	
	<!-- 삭제 -->
	<delete id="deleteTour" parameterClass="int">
		delete tour where no = #no#
	</delete>

</sqlMap>